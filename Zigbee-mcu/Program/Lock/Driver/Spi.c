#define SPI_C_

/* ------------------------------------------------------------------------------------------------
 *                                          Includes
 * ------------------------------------------------------------------------------------------------
 */
#include "Spi.h"


/**************************************************************************************************
 * @fn          Spi_Delay
 * @brief       1us左右的延时
 * @param       n
 * @return      无
 **************************************************************************************************
 */
void Spi_Delay(uint8_t n)
{
  uint8_t i;
  for (i=0; i<n; i++)
  {
    asm("nop");
  }
}

/**************************************************************************************************
 * @fn          Spi_IO_Init()
 * @brief       SPI端口初始化
 * @param       无
 * @return      无
 **************************************************************************************************
 */
void Spi_IO_Init(void)
{
  P1DIR |= 0x8C;  //P1_2、P1_3、P1_7设置为输出
  P0DIR |= 0x04;  //P0_2输出
  P0DIR &= ~0x08; //P0_3输入
}

/**************************************************************************************************
 * @fn          Spi_Init
 * @brief       SPI初始化
 * @param       无
 * @return      无
 **************************************************************************************************
 */
void Spi_Init(void)
{
  SCK = 0;        //SCK低电平空闲
  Spi_Delay(8);
  CS  = 1;        //片选为低电平有效，此时设置为无效
}





/**************************************************************************************************
 * @fn          Spi_ReadByte
 * @brief       字节数据读取
 * @param       无
 * @return      Spi_Rx -> 读取数据
 **************************************************************************************************
 */
uint8_t Spi_ReadByte(void)
{
  uint8_t i;
  uint8_t Spi_Rx = 0x00;
  
  SCK = 0;
  
  for(i=8; i>0; i--)
  {
    SCK = 1;
    Spi_Rx <<= 1;
    Spi_Rx |= MISO;   //上升沿读取数据
    SCK = 0;          //循环的最后一次仍然是低电平，低电平空闲
  }
  return Spi_Rx;
}



/**************************************************************************************************
 * @fn          Spi_WriteByte
 * @brief       字节数据发送
 * @param       Spi_Tx -> 发送字节
 * @return      无
 **************************************************************************************************
 */
void Spi_WriteByte(uint8_t Spi_Tx)
{
  uint8_t i;
  
  SCK = 0;
  
  for(i=8; i>0; i--)
  {
    MOSI = ((Spi_Tx&0x80)==0x80); //从高位开始输出
    SCK = 1;                      //上升沿时将数据发送出去
    Spi_Tx <<= 1;
    SCK = 0;
  }
}




